<html>
	<head>
		<script type="text/javascript" src="../lib/jquery-1.8.3.min.js"></script>
		<script type="text/javascript" src="../lib/jquery.hammer.min.js"></script>
		<meta charset="utf-8">
	<style type="text/css">
		body{
			margin: 0px;
			padding: 0px;
			width: 100%;
			overflow: hidden;
			font-family: arial;
		}
		#perse{
			position: absolute;
			top: 0px;
			left: 10%;
			width: 80%;
			height: 91%;
			border: 8px solid #000;
			
			padding: 0px;
			margin: 0px;
		}

		.pane{
			position: relative;
			border: 1px solid #d00;
			width: 20%;
			height: 100%;
			display: inline-block;
			margin: 1%;
			overflow: hidden;
		}

		.pane:before{
			content: attr(name);
			position: absolute;
			top: 20px;
			left: 20px;			
			font-size: 72pt;
			color: #555;
		}
		.pane:after{
			content: attr(index);
			position: absolute;
			bottom: 80px;
			right: 0px;			
			font-size: 170pt;
			color: #aaa;			
		}

		#muna{
			position: absolute;
			width: 100%;
			text-align: center;
			top:0px;
			left: 0px;
		}
	</style>
	
	<script type="text/javascript">

	$.fn.extend({
		switcher:function(opts){
			var me = this,				
				_container = $('<div class="scroll-container"></div>'),
				_panes = [],
				_position = -2,
				_list = opts.list;


			for (var i = 0; i<5; i++){
				var e = $('<div id="pane-'+i+'" class="pane"></div>');
				_container.append(e);
				e.css({
					position:'absolute',
					top:0,
					left:0
				});

				_panes.push(e);	
			}


			this.html(_container);

			_container.css({
				height:'100%',
				'min-width':'100%',
				position:'relative',
				overflow:'hidden',
			});

			this.css({
				overflow:'hidden',
				position:'relative'
			});

			_setPosition(_panes[2], _container.innerWidth()/2 - _panes[2].outerWidth(true)/2);
			_setPosition(_panes[1], _getPosition(_panes[2]) - _panes[1].outerWidth(true));
			_setPosition(_panes[0], _getPosition(_panes[1]) - _panes[0].outerWidth(true));
			_setPosition(_panes[3], _getPosition(_panes[2]) + _panes[2].outerWidth(true));
			_setPosition(_panes[4], _getPosition(_panes[3]) + _panes[3].outerWidth(true));
			_setIndexes();

			if (!opts.width){
				opts.width = _panes[0].outerWidth(true);
			}
						

			
			var _moved = 0,
				_prevMove = 0,
				_prevEvent = false,
				_chDist = 0,
				_lastCh = 0,
				_cDist = 0;
				

			this.hammer().on('touchstart',function(e){
				_prevEvent=false;
			});

			this.hammer().on('drag',function(e){			
				e.stopPropagation();
				e.preventDefault();




				var dist =0;
				if (_prevEvent){
					dist = e.gesture.deltaX - _prevEvent.gesture.deltaX;
					_cDist += dist;
				}


				_chDist = _cDist / opts.width;
				
				$('#muna').text(_chDist)

				for (var i in _panes){	
					_moveRatio(_panes[i], dist / _panes[i].outerWidth(true))
				}


				if (Math.abs(_chDist) >= 1 ){
					_chElements(_chDist);
					_cDist = 0;
					_chDist = 0;
					if (opts.onchange){
						opts.onchange.call(_getMiddle(),this);
					}
				}

				_prevEvent = e;				
			});

			this.hammer().on('touchend',function(e){
				
			});


			function _chElements(dist){
				if (dist > 0){
					var p = _getFirst(),
						p2 = _getLast(),
						d = _getPosition(p) - p2.outerWidth(true);
						_setPosition(p2,d);
						_position--;
				} else {
					var p2 = _getFirst(),
						p = _getLast(),
						d = _getPosition(p) + p.outerWidth(true);
						
						_setPosition(p2,d);
						_position++;
				}
				_setIndexes();				
			}

			function _setIndexes(){
				var panes = _getPanesByPosition();
				for (var i in panes){
					var index = parseInt(i)+_position;
					panes[i].attr('index',index);
					panes[i].attr('name',_getListItem(index));
				}
			}

			function _getPanesByPosition(){
				var t = [];

				for (var i in _panes){
					t.push(_panes[i]);
				}

				t.sort(function(a,b){
					return _getPosition(a) - _getPosition(b);
				});
				return t;				
			}

			function _getMiddle(){
				t = _getPanesByPosition();
				return t[2];
			}

			function _getLast(){
				var maxPos = -Infinity,
					lastE = false;

				for (var i in _panes){
					var pos = _getPosition( _panes[i]);
					
					if (pos > maxPos){
						maxPos = pos;
						lastE = _panes[i];
					}
				}				
				return lastE;
			}

			function _getFirst(){
				var minPos = Infinity,
					firstE = false;

				for (var i in _panes){
					var pos = _getPosition( _panes[i]);
					
					if (pos < minPos){
						minPos = pos;
						firstE = _panes[i];
					}
				}
				return firstE;
			}

			function _getPosition(pane){
				if (pane.attr('x-pos')){
					return parseFloat( pane.attr('x-pos') );
				} else {
					return parseFloat( pane.css('left') );
				}
			}

			function _moveRatio(pane,percent){
				_setPosition(pane, _getPosition(pane) + pane.outerWidth(true)*percent );
			}

			function _move(pane,offset){
				_setPosition(pane, _getPosition(pane) + offset );
			}

			function _setPosition(pane,x){
				pane.attr('x-pos',x);
				pane.css({
					'transform':'translate('+x+'px,0px)'
				});
			}
			


			function _getListItem(index){
				if (index >= _list.length){
					return _getListItem( index - _list.length);
				}  else if (index < 0){								
					return _getListItem(Math.abs(index) );
				} else {
					return _list[index];
				}
			}

			function _getIndex(name){
				var found =false;
				for (var i in _list){
					if (_list[i] == name){
						found = i;
						break;
					}
				}
				return found;
			}

			function _getPrev(name){
				var found = false;
				var i = _getIndex(name);
				if (i!=false){
					if (i-1 >= 0 && _list[i-1]){
						found = _container.find('#'+_list[i-1]);
					} else {
						found = _container.find('#'+_list[_list.length-1]);
					}
				}
				return found;
			}

			function _getNext(name){
				var found = false;
				var i = _getIndex(name);
				if (i!=false){
					if (_list.length > i && _list[i+1]){
						found = _container.find('#'+_list[i+1]);
					} else {
						found = _container.find('#'+_list[0]);
					}
				}
				return found;
			}
		}
	});


	$(function(){
		$('#perse').switcher({
			list:['eka','toinen','kolmas','teuvo loman'],

			onchange:function(pane){
				/*
				console.log(pane);
				console.log(this);
				*/
			}
		});
	});

	</script>
	</head>

	<body>
		<h1 id="muna"></h1>

		<div id="perse">
		</div>
	</body>
</html>